Menu="Tailscale"
Icon="tailscale.png"
Title="Lock"
Type="xmenu"
Tag="lock"
---
<?php
$signingNode = false;

switch (true) {
    case $tailscale_output['lock_signing']:
        $signingNode = true;
        break;
    case $tailscale_output['lock_signed']:
        echo "Your tailnet has lock enabled and the current node is signed. This is not currently a signing node.<br />";
        echo "If you wish to make this a signing node, you will need to trust the following key from a signing node:<br /><br />";
        echo $tailscale_output['lock_pubkey'];
        break;
    case $tailscale_output['lock_enabled']:
        echo "Your tailnet has lock enabled and the current node is not signed. This node will not be able to communicate with the tailnet.<br />";
        echo "To enable this node, trust the following key from a signing node:<br /><br />";
        echo $tailscale_output['lock_nodekey'];
        break;
    default:
        echo "Your tailnet does not have lock enabled.";
        break;
}

if ($signingNode) {
?>

<form markdown="1" method="POST" action="/update.php" target="progressFrame">
<input type="hidden" name="#command" value="/usr/local/emhttp/plugins/tailscale/approve-nodes.php" />

### Tailscale Lock: Approve Nodes

<table style="margin-top: 5px;">
<?php
foreach ($tailscale_output['lock_pending'] as $lockHost => $lockKey) {
    echo "<tr><td><input type='checkbox' name='#arg[]' value='{$lockKey}' /></td><td>{$lockHost}<br />{$lockKey}</td></tr>";
}
?>
</table>

<input type="submit" name="#apply" value="Approve">
</form>


<?php } ?>